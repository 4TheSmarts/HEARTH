# H011
DLL Sideloading Behavior

| Hunt # | Idea / Hypothesis                                                                 | Tactic           | Notes                                   | Tags                                   | Submitter   | 
|--------------|----------------------------------------------------------------------------|------------------|-----------------------------------------|----------------------------------------|----------------------------------------|
| H011        | For sideloading a DLL into vulnerable binary, a threat actors would be dropping (creating) EXE and DLL files under user writeable directories and then executing the same newly created EXE file so that it loads the newly created and unverified (Dig sign unverified) DLL from the same directory. | Persistence, Privilege Escalation, Defense Evasion | Limitations: There are no such limitations other than non-availability of required logs. Sometimes, we tend to not collect "Module Load" events due to their huge volume. In such case we would not be able to perform this hunt. Also, for correlation of data we need advance query language such as SQL, KQL or better enough if we can use Pandas.</br></br>Assumption: Assuming that threat actor is using standard user rights and is using a DLL that has unverifiable digital signature (DLL is signed but certificates are not verified).</br></br>Data sets required: EDR logs - "File Creation" and "Module Load" events.</br></br>Query creation steps:</br></br>1. Select .dll File Creation Events: From the "File Creation" logs, select all .dll file creation events. Ensure that the folder path of the newly created .dll file is not among the following: c:\windows\system32, c:\windows\syswow64, and c:\windows\sxs. Additionally, the verification status of the .dll file should be "Not Verified".</br></br>2. Select .exe File Creation Events: Next, from the "File Creation" logs, select all .exe file creation events. The condition for selection is that the folder path of the .exe file matches the folder path of the .dll files identified in the previous step. Furthermore, the absolute time difference between the .dll file creation event and the .exe file creation event should be less than one minute.</br></br>3. Select DLL Load Events: Finally, from the "Module Load" logs, select all DLL load events where the file name and path of the loaded DLL and the file name and path of the EXE loading that DLL match the names and paths of the .dll and .exe files identified in the previous steps. Additionally, the time of the module load event should be greater than the time of the DLL creation event.  | #Persistence #Privilege Escalation #Defense Evasion #DLLSideloading      | [hu983r](https://github.com/Communicateme)

## Why

- What security risks or threats does this hunt address?</br>This hunt addresses the security risk of DLL sideloading, a technique where attackers exploit the Windows DLL search order to load malicious DLLs instead of legitimate ones. This can be used to execute arbitrary code, escalate privileges, or maintain persistence within a compromised system1.
- What are the potential impacts if malicious activity is found?</br>If malicious activity is found, it could lead to data breaches, unauthorized access to sensitive information, and potential disruption of critical services. Attackers could gain control over the system, leading to further exploitation and compromise of additional assets.
- How does this hunt connect to known threat campaigns or protect critical assets?</br>This hunt is connected to known threat campaigns such as those conducted by APT41, APT41 (also known as Winnti Group), and other advanced threat actors. By detecting DLL sideloading attempts, organizations can protect critical assets like sensitive data, intellectual property, and critical infrastructure from being compromised.
- Why would this hunt be valuable to the community?</br>This DLL sideloading technique is particularly valuable because it is often missed by Endpoint Detection and Response (EDR) systems. This is due to the fact that DLL sideloading can masquerade as legitimate application behavior, making it difficult for EDRs to differentiate between benign and malicious activity. Attackers exploit trusted binaries to load their malicious DLLs, effectively bypassing security controls.
By conducting hunts specifically targeting this behavior, we can identify and mitigate threats that would otherwise go undetected by traditional EDR solutions. This proactive approach helps the community to enhance their detection capabilities, protect critical assets, and reduce the overall risk of a security breach.

## References

- https://attack.mitre.org/techniques/T1574/002/
- https://www.group-ib.com/blog/hunting-rituals-dll-side-loading/
- https://www.cybereason.com/blog/threat-analysis-report-dll-side-loading-widely-abused
